"use strict";

/*
 * # Express
 *
 * - Express æ˜¯ Node.js çš„æœåŠ¡å™¨è½¯ä»¶
 * - é€šè¿‡ Express å¯ä»¥å¿«é€Ÿçš„åœ¨ Node.js ä¸­æ­å»ºä¸€ä¸ª Web æœåŠ¡å™¨
 * - ä½¿ç”¨æ­¥éª¤
 *   1. åˆ›å»ºå¹¶åˆå§‹åŒ–é¡¹ç›®
 *   2. å®‰è£… Express
 *   3. åˆ›å»º `index.js` å¹¶ç¼–å†™ä»£ç 
 */
// å¼•å…¥ express
const express = require("express");

// è·å–æœåŠ¡å™¨çš„å®ä¾‹ï¼ˆå¯¹è±¡ï¼‰
const app = express();

/*
 * - å¦‚æœå¸Œæœ›æœåŠ¡å™¨å¯ä»¥æ­£å¸¸è®¿é—®ï¼Œåˆ™éœ€è¦ä¸ºæœåŠ¡å™¨è®¾ç½®è·¯ç”±
 *   - è·¯ç”±å¯ä»¥æ ¹æ®ä¸åŒçš„è¯·æ±‚æ–¹å¼å’Œè¯·æ±‚åœ°å€æ¥å¤„ç†ç”¨æˆ·çš„è¯·æ±‚
 * - åœ¨è·¯ç”±ä¸­åº”è¯¥åšä¸¤ä»¶äº‹
 *   1. è¯»å–ç”¨æˆ·çš„è¯·æ±‚ï¼ˆrequestï¼‰
 *   2. æ ¹æ®ç”¨æˆ·çš„è¯·æ±‚è¿”å›å“åº”ï¼ˆresponseï¼‰
 * - è·¯ç”±çš„å›è°ƒå‡½æ•°æ‰§è¡Œæ—¶ï¼Œä¼šæ¥æ”¶åˆ°ä¸‰ä¸ªå‚æ•°
 *   1. request
 *      - è¡¨ç¤ºç”¨æˆ·çš„è¯·æ±‚ä¿¡æ¯
 *      - é€šè¿‡ req å¯ä»¥è·å–ç”¨æˆ·ä¼ é€’æ•°æ®
 *   2. response
 *      - è¡¨ç¤ºæœåŠ¡å™¨çš„å“åº”ä¿¡æ¯
 *      - é€šè¿‡ res å¯ä»¥å‘ç”¨æˆ·è¿”å›æ•°æ®
 *   3. next
 *      - æ˜¯ä¸€ä¸ªå‡½æ•°
 *      - è°ƒç”¨å‡½æ•°åï¼Œå¯ä»¥è§¦å‘åç»­çš„è·¯ç”±
 *      - ä¸èƒ½åœ¨å“åº”å¤„ç†å®Œæ¯•åè°ƒç”¨
 * - ä¸­é—´ä»¶
 *   - åœ¨ Express ä¸­ï¼Œä½¿ç”¨ `app.use()` æ¥æ³¨å†Œä¸­é—´ä»¶
 *   - ä¸­é—´ä»¶çš„ä½œç”¨å’Œè·¯ç”±ç±»ä¼¼ï¼Œç”¨æ³•ä¹Ÿç±»ä¼¼
 *   - ä½†æ˜¯ä¸­é—´ä»¶ä¸åŒºåˆ†è¯·æ±‚çš„æ–¹å¼ï¼Œåªçœ‹è·¯å¾„
 *   - å’Œè·¯ç”±çš„åŒºåˆ«
 *     - ä¼šåŒ¹é…æ‰€æœ‰è¯·æ±‚
 *     - è·¯å¾„è®¾ç½®çš„æ—¶çˆ¶ç›®å½•
 */
app.use((req, res, next) => {
    console.log(1, req.method, req.url);

    // res.send("<h1>è¿™æ˜¯é€šè¿‡ä¸­é—´ä»¶è¿”å›çš„å“åº” 1</h1>");
    next();
});

app.use((req, res) => {
    console.log(2, req.method, req.url);

    res.send("<h1>è¿™æ˜¯é€šè¿‡ä¸­é—´ä»¶è¿”å›çš„å“åº” 2</h1>");
});

app.use((req, res) => {
    console.log(3, req.method, req.url);

    res.send("<h1>è¿™æ˜¯é€šè¿‡ä¸­é—´ä»¶è¿”å›çš„å“åº” 3</h1>");
});

// app.get("/", (req, res) => {
//     console.log("æœ‰äººè®¿é—®äº†æœåŠ¡å™¨");
//     console.log(req.url);
//
//     /*
//      * - `res.sendStatus()`ï¼šå‘å®¢æˆ·ç«¯å‘é€å“åº”çŠ¶æ€ç 
//      * - `res.status()`ï¼šç”¨æ¥è®¾ç½®å“åº”çŠ¶æ€ç ï¼Œä½†æ˜¯å¹¶ä¸å‘é€
//      * - `res.send()`ï¼šè®¾ç½®å¹¶å‘é€å“åº”ä½“
//      */
//     // res.sendStatus(404);
//     // res.status(404);
//     res.status(200);
//     // res.send("<h1>ä½ çš„è¯·æ±‚æ²¡é—®é¢˜ï¼Œä½†å°±æ˜¯ä¸ç»™ä½ çœ‹å“ˆğŸ¤ª</h1>");
//     res.send("<h1>æ­ªæ¯”å·´åœ</h1>");
// });

/*
 * ## å¯åŠ¨æœåŠ¡å™¨
 *
 * - `app.listen(ç«¯å£å·)`ï¼šç”¨æ¥å¯åŠ¨æœåŠ¡å™¨
 *   - æœåŠ¡å™¨å¯åŠ¨åï¼Œä¾¿å¯ä»¥é€šè¿‡ `3000` ç«¯å£æ¥è®¿é—®äº†
 */
app.listen(3000, () => {
    console.log("æœåŠ¡å™¨å¯åŠ¨æˆåŠŸ");
});

console.log("Hi, Express");
